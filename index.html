index.html
1,262 lines

html


index.html
1,103 lines

html


index.html
1,262 lines

html


index.html
1,067 lines

html

I upload phonalab's landing page and the front ends for the three tools (voice analyzer, pitch visualizer, and avqi-abi calculator). Please update the headers of the front ends so they look the same as the landing page. Also, add metadata for the avqi-api-tool, similarly as to the others tools.

I'll update the headers for all three tools to match the landing page and add comprehensive metadata for the AVQI/ABI tool.

AVQI & ABI Analyzer - Updated Header & Metadata
Interactive artifact 
Continue

AVQI & ABI Analyzer - Updated Header & Metadata
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 2 
Perfect! I've updated the AVQI & ABI Analyzer with:

Updates Made:
1. Matching Header & Navigation
Same dropdown menu structure as the landing page
Mobile menu with collapsible tools section
Consistent styling and behavior across all tools
2. Comprehensive Metadata
Added complete SEO and social media metadata:

Primary meta tags with detailed description
Open Graph tags for Facebook sharing
Twitter Card tags
Detailed keywords covering AVQI, ABI, multiparametric analysis
Schema.org structured data highlighting the 6+9 parameter analysis
Favicon references
3. Key Features in Metadata
The metadata now emphasizes:

World's first web-based AVQI/ABI calculator
Validation for Brazilian Portuguese (Englert et al.)
Multiparametric analysis (6 AVQI + 9 ABI parameters)
Clinical cutoff points (>1.33 for AVQI, >2.94 for ABI)
Standard protocol (counting 1-11 + sustained /a/)
Would you like me to create similar updated versions for the Voice Analyzer and Pitch Visualizer tools with the matching header?

yes please

Voice Analyzer - Updated Header
Interactive artifact 
Continue

Voice Analyzer - Updated Header
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 2 
Now let me create the updated Pitch Visualizer:

Pitch Visualizer - Updated Header
Interactive artifact 
Continue

Pitch Visualizer - Updated Header
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 2 
Perfect! I've successfully updated all three tool frontends with:

‚úÖ Complete Updates for All Tools
1. AVQI & ABI Analyzer
Matching header with dropdown menu and mobile navigation
Comprehensive metadata (SEO, Open Graph, Twitter Cards, Schema.org)
Emphasizes: world's first web-based calculator, Brazilian Portuguese validation, multiparametric analysis
2. Voice Analyzer
Matching header with dropdown menu and mobile navigation
Already had good metadata, maintained consistency
Emphasizes: F0, jitter, shimmer, HNR, CPP analysis with AI interpretation
3. Pitch Visualizer
Matching header with dropdown menu and mobile navigation
Already had good metadata, maintained consistency
Emphasizes: gender-affirming voice therapy, feminization/masculinization tracking
Key Features Across All Tools:
‚ú® Consistent Navigation

Desktop: Dropdown menu for "Tools" with all three options
Mobile: Collapsible hamburger menu with tools section
Same styling and behavior as the landing page
‚ú® Complete SEO & Social Sharing

Primary meta tags with detailed descriptions
Open Graph tags for Facebook
Twitter Card tags
Schema.org structured data for search engines
Canonical URLs
‚ú® Interactive Dropdowns

Click-to-open dropdowns on desktop
Click-outside-to-close behavior
Smooth animations
‚ú® Mobile-Friendly

Responsive hamburger menu
Full mobile navigation
Touch-friendly interface
All three tools now have a unified, professional appearance that matches your landing page! üéâ

THnk you. The front ends are deployed in vercel.com and I use cloudflare. Please help me configure vercel and cloudflare for the avqi-api tool

I'll help you configure Vercel and Cloudflare for the AVQI/ABI tool. Here's a comprehensive guide:

Step 1: Deploy to Vercel
A. Create vercel.json in your project root
vercel.json - AVQI Tool Configuration
Code 
B. Project Structure for AVQI Tool
Your project folder should look like:

avqi-tool/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ vercel.json
‚îú‚îÄ‚îÄ favicon-96x96.png
‚îú‚îÄ‚îÄ favicon.svg
‚îú‚îÄ‚îÄ favicon.ico
‚îú‚îÄ‚îÄ apple-touch-icon.png
‚îî‚îÄ‚îÄ site.webmanifest
C. Deploy to Vercel
Option 1: Via Vercel CLI

bash
# Install Vercel CLI
npm i -g vercel

# Navigate to your project folder
cd avqi-tool

# Deploy
vercel

# For production deployment
vercel --prod
```

**Option 2: Via Vercel Dashboard**
1. Go to https://vercel.com/new
2. Import your Git repository (GitHub, GitLab, Bitbucket)
3. Select the project folder
4. Vercel auto-detects the configuration
5. Click "Deploy"

---

## Step 2: Configure Custom Domain in Vercel

### A. Add Domain in Vercel Dashboard

1. Go to your project in Vercel Dashboard
2. Click **Settings** ‚Üí **Domains**
3. Add your domain: `avqi.phonalab.com`
4. Vercel will show you the required DNS records

You'll see something like:
```
Type: CNAME
Name: avqi
Value: cname.vercel-dns.com
Step 3: Configure Cloudflare DNS
Cloudflare DNS Configuration Guide
Document 
Now let me create a quick reference card for the complete setup:

Complete Deployment Checklist - AVQI Tool
Document 
Perfect! I've created three comprehensive guides for you:

üì¶ What I've Provided:
vercel.json - Configuration file with:
Static site build settings
Security headers (X-Frame-Options, CSP, etc.)
Caching rules for assets
Proper routing
Cloudflare DNS Configuration Guide - Complete walkthrough with:
Step-by-step DNS setup
CNAME record configuration
Proxy settings (when to enable/disable)
SSL/TLS configuration
Troubleshooting common issues
Verification commands
Complete Deployment Checklist - Quick reference with:
All deployment steps in order
Configuration for all three tools
Common issues and solutions
Performance optimization tips
Security enhancements
Final verification checklist
üöÄ Quick Start Summary:
Add vercel.json to your project folder
Deploy to Vercel (via Git or CLI)
Add domain in Vercel: avqi.phonalab.com
Add CNAME in Cloudflare:
Name: avqi
Target: cname.vercel-dns.com
Proxy: ‚ö™ OFF initially (critical!)
Wait 10-15 minutes for DNS + SSL
Enable Cloudflare proxy (optional, after SSL works)
Test: https://avqi.phonalab.com
‚ö†Ô∏è Most Important Point:
Keep Cloudflare proxy OFF (gray cloud) when first adding the domain, so Vercel can verify ownership and issue SSL certificates. After SSL is active, you can enable the proxy.

Would you like me to clarify any specific step or create additional configuration files?


None of the other two front ends have vercel.json files, should I add them?

Yes, you should add vercel.json files to all three frontend projects! Here's why and what to add:

Why Add vercel.json?
Security Headers - Protects against common vulnerabilities
Proper Caching - Improves performance
Clean URLs - Ensures routing works correctly
Consistent Configuration - All projects have same security/performance settings
Files to Create:
vercel.json - Configuration for All Tools
Code 
What This Configuration Does:
üõ°Ô∏è Security Headers:
X-Content-Type-Options: nosniff - Prevents MIME type sniffing
X-Frame-Options: DENY - Prevents clickjacking attacks
X-XSS-Protection - Enables browser XSS protection
Referrer-Policy - Controls referrer information
Permissions-Policy - Allows microphone access (needed for recording)
‚ö° Performance Headers:
Cache-Control for images/icons - 1 year caching
Cache-Control for CSS/JS - 1 year caching (if you add separate files later)
üîÑ Routing:
Single-page app routing - all requests go to index.html
Where to Add This File:
Project Structure:
voice-analyzer/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ vercel.json  ‚Üê ADD THIS
‚îú‚îÄ‚îÄ favicon-96x96.png
‚îú‚îÄ‚îÄ favicon.svg
‚îî‚îÄ‚îÄ ...

pitch-visualizer/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ vercel.json  ‚Üê ADD THIS
‚îú‚îÄ‚îÄ favicon-96x96.png
‚îú‚îÄ‚îÄ favicon.svg
‚îî‚îÄ‚îÄ ...

avqi-abi-tool/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ vercel.json  ‚Üê ADD THIS
‚îú‚îÄ‚îÄ favicon-96x96.png
‚îú‚îÄ‚îÄ favicon.svg
‚îî‚îÄ‚îÄ ...

phonalab-landing/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ vercel.json  ‚Üê ADD THIS (if not already there)
‚îú‚îÄ‚îÄ hero2.png
‚îî‚îÄ‚îÄ ...
Quick Action Steps:
Copy the vercel.json file above
Add it to each of your 3-4 project folders:
voice-analyzer/
pitch-visualizer/
avqi-abi-tool/
phonalab-landing/ (main site)
Commit and push (if using Git):
bash
git add vercel.json
git commit -m "Add Vercel configuration with security headers"
git push
Vercel will auto-redeploy with the new configuration
Benefits You'll Get:
‚úÖ Better Security Score - Tools like securityheaders.com will rate your site higher ‚úÖ Faster Load Times - Proper caching reduces bandwidth ‚úÖ SEO Benefits - Search engines favor secure, fast sites ‚úÖ Professional Setup - Industry best practices ‚úÖ Consistent Configuration - All tools have same settings

Optional: Check Your Current Security
Before and after adding vercel.json, test your sites:

https://securityheaders.com/?q=https://analyzer.phonalab.com
https://observatory.mozilla.org/
You should see improved scores after adding the configuration!

Bottom line: Yes, definitely add vercel.json to all projects. It's a one-time setup that provides ongoing benefits with zero maintenance. üéØ



vercel.json
26 lines

json

The landing page already had this vercel.json, could you update it

I'll update the landing page vercel.json to include both the redirects and the security/performance headers:

vercel.json - Landing Page (Updated)
Code 
Perfect! I've updated the landing page vercel.json to include:

‚úÖ What's Now Included:
1. Original Redirects (Preserved)
phonalab.com ‚Üí www.phonalab.com (with all paths)
Permanent 301 redirects for SEO
2. Security Headers (New)
X-Content-Type-Options
X-Frame-Options
X-XSS-Protection
Referrer-Policy
Permissions-Policy
3. Performance Caching (New)
Hero image (hero2.png) - 1 year cache
All favicon files - 1 year cache
Social media images (og-image, twitter-image) - 1 year cache
All CSS/JS files - 1 year cache
4. Routing (New)
SPA-style routing to index.html
üìù Summary of Changes:
Before: Only had redirects After: Redirects + Security + Performance + Routing

üöÄ What to Do:
Replace your current vercel.json in the landing page project with this updated version
Commit and push (Vercel will auto-redeploy)
Keep the original vercel.json (without redirects) for the three tools:
voice-analyzer/
pitch-visualizer/
avqi-abi-tool/
Why Different for Subdomains?
The redirects section is only needed for the main landing page because:

phonalab.com ‚Üí www.phonalab.com (canonical URL)
Subdomains (analyzer., pitch., avqi.) don't need redirects
They're already at their final destination
So you'll have:

Landing page: vercel.json WITH redirects
Three tools: vercel.json WITHOUT redirects (just security + performance)
This is the correct configuration! üéØ


runtime.txt
1 line

txt


main.py
1,589 lines

py


render.yaml
12 lines

yaml


requirements.txt
10 lines

txt

Thank you. My api is at render.com, and has these files. Is my api secured enough? SHould I add/adjust anything for better performance? It is on a starter program, with 512MB RAM and 0.5 CPU

Looking at your API setup, here are some important recommendations for security and performance optimization on Render's starter plan (512MB RAM, 0.5 CPU):

üîí Security Issues to Address
API Security & Performance Improvements
Document 
üéØ Summary of Critical Issues:
Security Problems:
‚ùå CORS allows ANY website to use your API (currently allow_origins=["*"])
‚ùå No rate limiting - anyone can spam requests
‚ùå No request timeouts - long requests can hang the service
Performance Issues:
‚ö†Ô∏è No worker limit in render.yaml (could use too much RAM)
‚ö†Ô∏è No garbage collection after processing large files
‚ö†Ô∏è No timeout protection for expensive operations
Missing Monitoring:
‚ö†Ô∏è Basic logging only
‚ö†Ô∏è No structured error handling
‚ö†Ô∏è No health check configuration
üí° Quick Wins (Do These Now):
Fix CORS - Replace ["*"] with your actual domains
Add SlowAPI for rate limiting (5 minutes to implement)
Update render.yaml with single worker config
These three changes will immediately make your API much more secure and prevent abuse!

Would you like me to create the complete updated main.py file with all these security improvements implemented?

yes please

main.py - Secured & Optimized Version
Code 
Continue

main.py - Secured & Optimized Version
Code‚ÄÇ‚àô‚ÄÇVersion 2 
Continue

main.py - Secured & Optimized Version
Code‚ÄÇ‚àô‚ÄÇVersion 3 
Now let me create the updated requirements.txt and render.yaml:

requirements.txt - Updated with SlowAPI
Code 
Perfect! Now let me create a deployment guide:

API Deployment Guide - Security & Performance
Document 
üéØ Summary
I've created a fully secured and optimized version of your API with:

üì¶ Three Updated Files:
main.py (2.2.0) - Complete rewrite with:
‚úÖ CORS restricted to your specific domains only
‚úÖ Rate limiting on all endpoints (prevents abuse)
‚úÖ Request timeout protection (60 seconds max)
‚úÖ Security headers (HSTS, X-Frame-Options, etc.)
‚úÖ Better error handling and logging
‚úÖ Memory optimization with garbage collection
‚úÖ Optional API key authentication (ready to enable)
requirements.txt - Added slowapi==0.1.9 for rate limiting
render.yaml - Optimized for 512MB RAM:
Single worker configuration
30-second keepalive timeout
Health check path configured
Environment variables optimized
üîí Security Improvements:
Before	After
allow_origins=["*"]	Only your 5 domains allowed
No rate limiting	5-20 requests/minute per endpoint
No timeouts	60-second request timeout
Basic logging	Structured logging with tracking
No error handling	Global exception handlers
‚ö° Performance Improvements:
Explicit garbage collection after processing
Single worker optimized for 512MB RAM
30-second keepalive (faster connection recycling)
Memory-efficient file processing
üìä Rate Limits Applied:
/analyze: 10 requests/minute
/analyze-full: 5 requests/minute (most expensive)
/analyze-auto: 8 requests/minute
/generate-pdf: 20 requests/minute
/health: 60 requests/minute
üöÄ Next Steps:
Replace the 3 files in your repository
Push to GitHub (Render auto-deploys)
Wait 5-10 minutes for build
Test the /health endpoint
Verify rate limiting works
Monitor RAM usage in Render dashboard
The API is now production-ready with enterprise-level security! üéâ

Thank you. I am having problems with the front ends for the tools:

In the avqi-abi tool, after uploading the sound files, there is no response.
In the voice analyzer tool, the button ti upload a sound file does not work

Let me debug these frontend issues. These are likely JavaScript event handling problems. Let me create fixed versions:

Issue 1: AVQI/ABI Tool - No Response After Upload
AVQI/ABI Tool - Fixed JavaScript
Interactive artifact 









Phonalab Development

index.html
36.25 KB ‚Ä¢1,103 lines
‚Ä¢
Formatting may be inconsistent from source
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Voice Analyzer - Free Acoustic Analysis | Phonalab</title>
    <meta name="title" content="Voice Analyzer - Free Acoustic Analysis | Phonalab">
    <meta name="description" content="Free professional voice analyzer for speech pathologists. Instant acoustic analysis: F0, jitter, shimmer, HNR, CPP with AI clinical interpretation. Upload sustained vowel recordings for comprehensive voice quality assessment.">
    <meta name="keywords" content="voice analyzer, acoustic analysis, F0 measurement, jitter shimmer analysis, voice quality assessment, dysphonia screening, HNR analysis, CPP measurement, voice disorder evaluation, SLP tools">
    <meta name="author" content="Dr. Jorge C. Lucero">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://analyzer.phonalab.com">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://analyzer.phonalab.com">
    <meta property="og:title" content="Voice Analyzer - Free Acoustic Analysis | Phonalab">
    <meta property="og:description" content="Free professional voice analyzer with instant acoustic analysis and AI clinical interpretation. For speech-language pathologists and voice clinicians.">
    <meta property="og:image" content="https://phonalab.com/og-voice-analyzer.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://analyzer.phonalab.com">
    <meta property="twitter:title" content="Voice Analyzer - Free Acoustic Analysis | Phonalab">
    <meta property="twitter:description" content="Free professional voice analyzer with instant acoustic analysis and AI clinical interpretation.">
    <meta property="twitter:image" content="https://phonalab.com/twitter-voice-analyzer.png">
    
     <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/svg+xml" href="favicon.svg" />
	<link rel="shortcut icon" href="favicon.ico" />
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
	<link rel="manifest" href="site.webmanifest" />
    
    <!-- Schema.org for Voice Analyzer -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Phonalab Voice Analyzer",
      "applicationCategory": "HealthApplication",
      "operatingSystem": "Web browser",
      "description": "Professional acoustic voice analysis tool measuring F0, jitter, shimmer, HNR, and CPP with AI-powered clinical interpretation",
      "url": "https://analyzer.phonalab.com",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Fundamental frequency (F0) analysis",
        "Jitter measurement (pitch perturbation)",
        "Shimmer measurement (amplitude perturbation)",
        "Harmonics-to-noise ratio (HNR)",
        "Cepstral peak prominence (CPP)",
        "AI clinical interpretation",
        "PDF report generation",
        "Mobile-friendly interface"
      ]
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f9fafb;
            --white: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .header {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text);
            text-decoration: none;
            transition: color 0.3s;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .tool-header {
            padding: 60px 0 40px;
            text-align: left;
        }

        .tool-header h1 {
            font-size: 2.5rem;
            color: var(--text);
            margin-bottom: 0.75rem;
            font-weight: 700;
        }

        .tool-header p {
            color: var(--text-light);
            font-size: 1.2rem;
            max-width: 700px;
        }

        .upload-section {
            background: var(--white);
            border-radius: 12px;
            padding: 3rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 4rem 2rem;
            transition: all 0.3s;
            cursor: pointer;
            text-align: center;
            background: var(--bg);
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: translateY(-2px);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.7;
        }

        .upload-area h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .upload-area p {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.8;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            background: var(--primary);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1.5rem;
        }

        .upload-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .audio-player {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            display: none;
        }

        .audio-player h3 {
            margin-bottom: 1rem;
            color: var(--text);
            font-size: 1.1rem;
        }

        audio {
            width: 100%;
            margin-bottom: 1rem;
        }

        .analyze-button {
            background: var(--success);
            color: white;
            padding: 16px 48px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: none;
            transition: all 0.3s;
        }

        .analyze-button:hover:not(:disabled) {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .analyze-button:disabled {
            background: var(--text-light);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 3rem 0;
            padding: 3rem;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .spinner {
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading p {
            font-size: 1.1rem;
            color: var(--text);
        }

        .loading p:last-child {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-top: 0.5rem;
        }

        .results-section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--text);
            font-weight: 700;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .result-card {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border-left: 4px solid var(--primary);
        }

        .result-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .result-label {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1;
            margin-bottom: 0.75rem;
        }

        .result-unit {
            font-size: 1.2rem;
            color: var(--text-light);
            margin-left: 0.25rem;
            font-weight: 500;
        }

        .result-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-normal {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .status-concern {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .interpretation {
            background: var(--white);
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2.5rem;
        }

        .interpretation h2 {
            margin-bottom: 1.5rem;
            color: var(--text);
            font-size: 1.75rem;
            font-weight: 700;
        }

        .interpretation-text {
            color: var(--text);
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .interpretation-list {
            list-style: none;
            margin-top: 1.5rem;
        }

        .interpretation-list li {
            padding: 0.75rem 0;
            display: flex;
            align-items: start;
            color: var(--text-light);
            line-height: 1.6;
        }

        .interpretation-list li::before {
            content: "√¢‚Ä†‚Äô";
            color: var(--primary);
            margin-right: 1rem;
            font-weight: bold;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2.5rem;
        }

        .button {
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .button-primary {
            background: var(--primary);
            color: white;
        }

        .button-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .button-secondary {
            background: var(--white);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .button-secondary:hover {
            background: var(--bg);
            border-color: var(--primary);
            color: var(--primary);
        }

        .info-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-left: 4px solid var(--primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-box p {
            color: var(--text);
            line-height: 1.6;
            margin: 0;
        }

        .info-box strong {
            color: var(--primary);
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%);
            border-left: 4px solid var(--warning);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .warning-box p {
            color: var(--text);
            line-height: 1.6;
            margin: 0.5rem 0;
        }

        .warning-box strong {
            color: var(--warning);
        }

        .alert-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            display: none;
        }

        .alert-box.show {
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }

        .alert-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .alert-content p {
            margin: 0;
            color: var(--text);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .alert-content strong {
            color: var(--warning);
        }

        .recording-tips {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .recording-tips h3 {
            color: var(--text);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .tip-item {
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }

        .tip-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .tip-content h4 {
            font-size: 1rem;
            margin-bottom: 0.25rem;
            color: var(--text);
        }

        .tip-content p {
            font-size: 0.9rem;
            color: var(--text-light);
            margin: 0;
        }

        .feedback-section {
            background: var(--white);
            border-radius: 12px;
            padding: 2.5rem;
            margin-top: 4rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .feedback-section h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
            color: var(--text);
        }

        .feedback-section p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        footer {
            padding: 3rem 0;
            text-align: center;
            color: var(--text-light);
            background: var(--white);
            border-top: 1px solid var(--border);
            margin-top: 4rem;
        }

        footer p {
            margin: 0.5rem 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 20px;
            }

            .header-content {
                padding: 0 20px;
            }

            .tool-header {
                padding: 40px 0 30px;
            }

            .tool-header h1 {
                font-size: 2rem;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            .action-buttons {
                flex-direction: column;
            }

            .button {
                width: 100%;
                text-align: center;
            }

            .upload-area {
                padding: 3rem 1.5rem;
            }

            .tips-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="https://phonalab.com" class="logo">√∞≈∏‚Äù¬¨ Phonalab</a>
            <nav class="nav-links">
                <a href="https://phonalab.com">Home</a>
                <a href="https://analyzer.phonalab.com">Voice Analyzer</a>
                <a href="https://pitch.phonalab.com">Pitch Visualizer</a>
                <a href="https://phonalab.com#about">About</a>
                <a href="https://forms.gle/oZvWFGcHwr7VFNRAA" target="_blank">Feedback</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="tool-header">
            <h1>Voice Analyzer</h1>
            <p>Upload a sustained vowel recording to get instant professional acoustic analysis with detailed measurements and clinical interpretation.</p>
        </div>

        <div class="info-box">
            <p><strong>How it works:</strong> Record yourself saying "aahhh" (like at the doctor's office) for 3-5 seconds at a comfortable pitch. The analyzer will measure fundamental frequency, jitter, shimmer, harmonics-to-noise ratio, and cepstral peak prominence√¢‚Ç¨‚Äùthe gold standard parameters for acoustic voice quality assessment.</p>
        </div>

        <div class="warning-box">
            <p><strong>√¢≈° √Ø¬∏¬è Important:</strong> Use sustained vowel recordings only (/a/, /i/, or /u/), not running speech or singing. Jitter and shimmer measurements require continuous phonation to be clinically valid.</p>
            <p style="margin-top: 0.75rem; font-size: 0.95rem;">Note: Files longer than 30 seconds will be automatically trimmed to the first 30 seconds for memory-optimized analysis.</p>
        </div>

        <div class="recording-tips">
            <h3>√∞≈∏‚Äú¬ù Recording Tips for Best Results</h3>
            <div class="tips-grid">
                <div class="tip-item">
                    <div class="tip-icon">√¢≈ì‚Ä¶</div>
                    <div class="tip-content">
                        <h4>What to Record</h4>
                        <p>Say "aahhh" steadily for 3-5 seconds at your normal speaking pitch</p>
                    </div>
                </div>
                <div class="tip-item">
                    <div class="tip-icon">√∞≈∏≈Ω¬§</div>
                    <div class="tip-content">
                        <h4>Recording Quality</h4>
                        <p>Quiet room, normal volume, 6-12 inches from microphone</p>
                    </div>
                </div>
                <div class="tip-item">
                    <div class="tip-icon">√∞≈∏‚Äù‚Ä°</div>
                    <div class="tip-content">
                        <h4>What to Avoid</h4>
                        <p>No speech, singing, pitch changes, or background noise</p>
                    </div>
                </div>
                <div class="tip-item">
                    <div class="tip-icon">√∞≈∏‚Äú¬±</div>
                    <div class="tip-content">
                        <h4>Any Device Works</h4>
                        <p>Phone voice recorder, computer mic, or any recording app</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">√∞≈∏≈Ω¬µ</div>
                <h2>Upload Sustained Vowel Recording</h2>
                <p>Drag & drop your audio file here, or click to browse</p>
                <p style="margin-top: 1rem; font-size: 0.9rem;">
                    Supports: WAV, MP3, M4A √¢‚Ç¨¬¢ Maximum file size: 50MB
                </p>
                <input type="file" id="fileInput" class="file-input" accept="audio/*">
                <button class="upload-button">Choose File</button>
            </div>

            <div class="alert-box" id="durationAlert">
                <div class="alert-icon">√¢≈° √Ø¬∏¬è</div>
                <div class="alert-content">
                    <p><strong>File Duration Notice:</strong> Your recording is longer than 30 seconds. The analyzer will use the first 30 seconds for optimal performance and accurate measurements.</p>
                </div>
            </div>

            <div class="audio-player" id="audioPlayer">
                <h3>Your Recording</h3>
                <audio id="audioElement" controls></audio>
                <button class="analyze-button" id="analyzeButton">
                    √∞≈∏‚Äù¬¨ Analyze Voice
                </button>
            </div>
        </div>

        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p>Analyzing voice parameters...</p>
            <p>This usually takes about 10 seconds</p>
        </div>

        <div class="results-section" id="resultsSection">
            <h2 class="section-title">Analysis Results</h2>
            
            <div class="results-grid" id="resultsGrid">
                <div class="result-card">
                    <div class="result-label">Fundamental Frequency (F0)</div>
                    <div class="result-value" id="f0Value">
                        --<span class="result-unit">Hz</span>
                    </div>
                    <div class="result-status status-normal" id="f0Status">Loading...</div>
                </div>

                <div class="result-card">
                    <div class="result-label">Jitter</div>
                    <div class="result-value" id="jitterValue">
                        --<span class="result-unit">%</span>
                    </div>
                    <div class="result-status status-normal" id="jitterStatus">Loading...</div>
                </div>

                <div class="result-card">
                    <div class="result-label">Shimmer</div>
                    <div class="result-value" id="shimmerValue">
                        --<span class="result-unit">%</span>
                    </div>
                    <div class="result-status status-normal" id="shimmerStatus">Loading...</div>
                </div>

                <div class="result-card">
                    <div class="result-label">Harmonics-to-Noise Ratio</div>
                    <div class="result-value" id="hnrValue">
                        --<span class="result-unit">dB</span>
                    </div>
                    <div class="result-status status-normal" id="hnrStatus">Loading...</div>
                </div>

                <div class="result-card">
                    <div class="result-label">Cepstral Peak Prominence</div>
                    <div class="result-value" id="cppValue">
                        --<span class="result-unit">dB</span>
                    </div>
                    <div class="result-status status-normal" id="cppStatus">Loading...</div>
                </div>
            </div>

            <div class="interpretation">
                <h2>Clinical Interpretation</h2>
                <div class="interpretation-text" id="interpretationText">
                    <p>Analysis complete. Based on the acoustic parameters:</p>
                    <ul class="interpretation-list" id="interpretationList">
                    </ul>
                </div>
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg); border-radius: 8px; font-size: 0.9rem; color: var(--text-light);">
                    <strong>Clinical Note:</strong> These measurements are valid for sustained phonation only. If your recording contained running speech, consonants, or pitch changes, the jitter and shimmer values should not be interpreted clinically.
                </div>
            </div>

            <div class="action-buttons">
                <button class="button button-primary" onclick="downloadPDF()">
                    √∞≈∏‚Äú‚Äû Download PDF Report
                </button>
                <button class="button button-secondary" onclick="analyzeAnother()">
                    √∞≈∏‚Äù‚Äû Analyze Another Recording
                </button>
            </div>
        </div>

        <div class="feedback-section">
            <h3>Help Improve This Tool</h3>
            <p>Your feedback helps us make Phonalab better for clinicians worldwide</p>
            <a href="https://forms.gle/oZvWFGcHwr7VFNRAA" target="_blank" class="button button-primary">
                √∞≈∏‚Äú¬ù Submit Feedback
            </a>
        </div>
    </div>

    <footer>
        <div class="container">
            <p><strong>Phonalab</strong> - Professional Voice Analysis Tools</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">
                √Ç¬© 2025 Jorge C. Lucero √¢‚Ç¨¬¢ For clinical correlation and professional use only
            </p>
        </div>
    </footer>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioElement = document.getElementById('audioElement');
        const analyzeButton = document.getElementById('analyzeButton');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');
        const durationAlert = document.getElementById('durationAlert');
        
        let audioFile = null;
        let currentAnalysisResults = null;

        // Click to upload
        uploadArea.addEventListener('click', (e) => {
            fileInput.click();
        });

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.type.startsWith('audio/')) {
                alert('Please upload an audio file');
                return;
            }

            if (file.size > 50 * 1024 * 1024) {
                alert('File size must be less than 50MB');
                return;
            }

            audioFile = file;
            const url = URL.createObjectURL(file);
            audioElement.src = url;
            
            // Check duration and show alert if > 30 seconds
            audioElement.addEventListener('loadedmetadata', function() {
                if (audioElement.duration > 30) {
                    durationAlert.classList.add('show');
                } else {
                    durationAlert.classList.remove('show');
                }
            });
            
            audioPlayer.style.display = 'block';
            analyzeButton.style.display = 'inline-block';
            
            uploadArea.innerHTML = `
                <div class="upload-icon">√¢≈ì‚Äù</div>
                <h2>${file.name}</h2>
                <p style="color: var(--success); font-weight: 600;">File uploaded successfully</p>
                <button class="upload-button" onclick="document.getElementById('fileInput').click()">Choose Different File</button>
            `;
        }

        analyzeButton.addEventListener('click', analyzeVoice);

        async function analyzeVoice() {
            analyzeButton.disabled = true;
            loadingSection.style.display = 'block';
            resultsSection.style.display = 'none';

            try {
                const formData = new FormData();
                formData.append('file', audioFile);

                const response = await fetch('https://voice-analyzer-api.onrender.com/analyze', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Analysis failed');
                }

                const data = await response.json();
                displayRealResults(data);
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert('Analysis error: ' + error.message);
            } finally {
                loadingSection.style.display = 'none';
                resultsSection.style.display = 'block';
                analyzeButton.disabled = false;
            }
        }

        function displayRealResults(data) {
            currentAnalysisResults = data;
            
            document.getElementById('f0Value').innerHTML = 
                `${data.f0.mean.toFixed(1)}<span class="result-unit">Hz</span>`;
            document.getElementById('f0Status').textContent = data.f0.status;
            
            document.getElementById('jitterValue').innerHTML = 
                `${data.jitter.percent.toFixed(2)}<span class="result-unit">%</span>`;
            document.getElementById('jitterStatus').textContent = data.jitter.status;
            
            document.getElementById('shimmerValue').innerHTML = 
                `${data.shimmer.percent.toFixed(2)}<span class="result-unit">%</span>`;
            document.getElementById('shimmerStatus').textContent = data.shimmer.status;
            
            document.getElementById('hnrValue').innerHTML = 
                `${data.hnr.mean.toFixed(1)}<span class="result-unit">dB</span>`;
            document.getElementById('hnrStatus').textContent = data.hnr.status;
            
            document.getElementById('cppValue').innerHTML = 
                `${data.cpp.value.toFixed(2)}<span class="result-unit">dB</span>`;
            document.getElementById('cppStatus').textContent = data.cpp.status;
            
            const list = document.getElementById('interpretationList');
            list.innerHTML = '';
            
            const overall = document.createElement('li');
            overall.textContent = data.interpretation.overall_assessment;
            list.appendChild(overall);
            
            if (data.interpretation.concerns) {
                data.interpretation.concerns.forEach(concern => {
                    const li = document.createElement('li');
                    li.textContent = concern;
                    list.appendChild(li);
                });
            }
            
            if (data.interpretation.recommendations) {
                data.interpretation.recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    list.appendChild(li);
                });
            }
        }

        async function downloadPDF() {
            if (!currentAnalysisResults) {
                alert('No analysis results available. Please analyze a voice recording first.');
                return;
            }
            
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

            try {
                const button = document.querySelector('button[onclick="downloadPDF()"]');
                
                if (button.disabled) return;
                
                const originalText = button.textContent;
                const originalBg = button.style.background;
                
                button.textContent = '√¢¬è¬≥ Generating PDF...';
                button.disabled = true;
                
                const response = await fetch('https://voice-analyzer-api.onrender.com/generate-pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        analysis_results: currentAnalysisResults,
                        patient_info: null
                    })
                });

                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }

                const blob = await response.blob();
                const fileName = `voice_analysis_${new Date().toISOString().slice(0,10)}.pdf`;
                
                if (isMobile) {
                    const url = URL.createObjectURL(blob);
                    window.open(url, '_blank');
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                } else {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    setTimeout(() => {
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    }, 200);
                }
                
                button.textContent = '√¢≈ì‚Ä¶ Downloaded!';
                button.style.background = '#10b981';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = originalBg || '';
                    button.disabled = false;
                }, 2500);
                
            } catch (error) {
                console.error('PDF Error:', error);
                alert('Could not generate PDF: ' + error.message);
                
                const button = document.querySelector('button[onclick="downloadPDF()"]');
                button.textContent = '√∞≈∏‚Äú‚Äû Download PDF Report';
                button.style.background = '';
                button.disabled = false;
            }
        }

        function analyzeAnother() {
            audioPlayer.style.display = 'none';
            resultsSection.style.display = 'none';
            durationAlert.classList.remove('show');
            audioFile = null;
            currentAnalysisResults = null;
            audioElement.src = '';
            fileInput.value = '';
            
            uploadArea.innerHTML = `
                <div class="upload-icon">√∞≈∏≈Ω¬µ</div>
                <h2>Upload Sustained Vowel Recording</h2>
                <p>Drag & drop your audio file here, or click to browse</p>
                <p style="margin-top: 1rem; font-size: 0.9rem;">
                    Supports: WAV, MP3, M4A √¢‚Ç¨¬¢ Maximum file size: 50MB
                </p>
                <button class="upload-button">Choose File</button>
            `;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
    <!-- Vercel Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>